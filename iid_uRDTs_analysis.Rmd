---
title: Performance evaluation of an ultra-sensitive rapid diagnosstic test for malaria
  in the low transmission setting of Zambezi Region, Namibia
author: Lisa M. Prach1, Leah Schrubbe1, Smita Das2, Munyaradzi Tambo3, Sofonias Tessema4,
  Lindsey Wu5, Mi-Suk Kang Dufour6, Petrina Uusiku7, Gonzalo J. Domingo2, Roly Gosling1,
  Bryan Greenhouse4, Sophie Allauzen8, Davis Mumbengegwi, Michelle S. Hsiang1.
date: "September 21th, 2020"
output:
  word_document: default
  html_document: default
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = TRUE)
```

# Performance evaluation of an ultra-sensitive rapid diagnostic test for malaria in the low transmission setting of Zambezi Region, Namibia.

## Background

Malaria trend globally, in Africa and in Namibia. Arguments that show the decrease in cases in Namibia, and specifically in the study area.   This decline in malaria cases corresponds with an increase in the geographical heterogeneity of the transmission and a rise in the proportion of asymptomatic sub-patent infections, and this pattern is more pronounced in areas of moderate or low transmission. In this way, malaria transmission is sustained by groups of individuals aggregated in limited geographic areas, called hotspots, that are difficult to detect through conventional surveillance and tools. So, targeting interventions with suitable tools in these areas is important to consolidate what has been achieved [1, 2].

Traditionally, hotspots are defined as small geographic areas (typically less than 1km) within a focus of malaria transmission, where exposure to infectious mosquito bites exceeds the average of its surrounding area [1]. Because of the constant exposure to infections within hotspots, immunity is developed faster, leading to high proportions of asymptomatic individuals with low parasite density that hardly ever are detected by conventional tools like microscopy or rapid diagnostic test (RDTs), and that do not seek for health care. For that reason, detecting antibody response to malaria-specific antigens through serological markers, and detecting asexual parasite carriers by molecular diagnosis are more useful tools for identifying malaria hotspots than the incidence of clinical episodes [3-5]. However, the use of these tools requires high technical expertise and complex equipment, making their implementation impractical in field settings.

Compared to standard RDTs, the new Alere Malaria Ag Plasmodium falciparum ultra-sensitive RDT (uRDT) has shown a 10-fold lower limit of detection of HRP2 antigen and increased sensitivity in frozen samples from Uganda and Myanmar [6]. Thus, this tool has the potential not only to be used in detecting asymptomatic infections but also could be used to detect geographic areas with increased transmission intensity sustained by malaria hotspots. For that reason, this analysis compared the use of uRDTs and standard RDTs in the identification of communities and households with greater malaria exposure detected by HRP2 ELISA test, real-time polymerase chain reaction (qPCR), and serologic markers from a cross-sectional survey as well as the incidence of clinical episodes, carried out in the low transmission setting of Zambezi region, Namibia.

## Methods:

The study population included individuals residing within the catchment areas of eleven health facilities in western Zambezi Region  (Figure 2). Specifically, 56 of 102 census enumeration areas (EAs) in the region were initially included based on reliability of incidence data from 2012 to 2014 and presence of incident cases during that time. EAsEAs with large geographical size and more than two borders with other contiguous EAsEAs were excluded from analysis (Figure 1 and Figure 2). For the household level data (HH), inclusion criteria included residence in randomly selected households or boarding schools within one of the EAs with around 25 households selected per EA. For individuals residing within the household, inclusion criteria included head of household consent, and age greater than six months. Exclusion criteria included not having slept in the household or boarding school at least three nights per week in the previous four weeks and refusal to participate.



```{r includ = FALSE, echo=FALSE}
#knitr::include_graphics("namibia_map_with_hatches_v2.jpg")
```
<p style="font-size:8pt; font-style:italic">**Figure 1:** Study site map.</p>

### Field procedures:

Questionnaires were administered to consenting subjects from selected households and schools using tablet computers and blood testing and collection was conducted. A household level questionnaire captured geolocation, household population, insecticide-treated bed net ownership, and indoor residual spray coverage. The individual level questionnaire captured demographic data. In addition, axillary temperature of each participant was measured and recorded. Written individual informed consent was obtained from adults, parental consent was obtained for children under 18 years old, and adolescent assent was obtained from minors 12-17 years old. To enroll as many individuals as possible, all households and schools were visited twice. Surveys were conducted in the local language of siLozi. A trained study nurse collected whole blood for malaria testing using a finger prick for each individual in the cross-sectional analysis.

### Laboratory or testing methods:

The collected blood was used to assess the presence of current or recent infection of parasites causing malaria using 1) the standard rapid diagnostic test (RDT) CareStartTM Malaria HRP2/pLDH (Pf/PAN) Combo test (AccessBio, Somerset, NJ, USA); 2) the Alere Malaria Ag P.f RDT Ultra-Sensitive (SD/Alere, Yongin-si, Republic of Korea) (uRDT); 3) quantitative real-time polymerase chain reaction (qPCR); 4) and the Q-plex ELISA method for HRP2 quantification (HRP2). The RDT and uRDT testing was performed following manufacturer instructions. Whole blood collected in the cross-sectional survey was centrifuged, and packed red blood cells were stored at -20°C before undergoing DNA extraction using the Quick-DNATMminiprep kit (Zymo Research Corp, Irvine, CA, USA) and a qPCR targeting the varATS region28 using template DNA corresponding to 10 μL of whole blood. Samples were considered qPCR positive if parasite density was greater than 0.1 p/μL. HRP2 concentration was determined using the Q-plex ELISA. All parasite density estimates for this study were determined by averaging duplicate runs by qPCR and described in p/μL. Samples were considered Q-plex HRP2 positive if HRP2 concentration was greater than the Q-plex assay limit of detection (LOD) of 2.3 pg/mL.

### Statistical analysis:

Individual demographic information (individual study ID, HH ID, EA ID and others), and the laboratory results of the performed diagnostic tests (positive and negative for the four test performed) were entered and stored in .dta format in STATA (version 13; STATA Corp., College Station, TX, USA) and then analyzed in R version 4.0.1 (R Foundation for Statistical Computing., Vienna, Austria). To evaluate the performance of RDTs and uRDTs in detecting hotspots, data was collapsed at EA and household level.

At EA level, incidence data (cases/1000 person years) was obtained by passive case detection through RDT and microscopy for patients who presented at health facilities during the broader trial study period. Each positive case was documented along with the individual’s EA ID. Prevalence by HRP2 and qPCR (reference tests), and by RDTs and uRDTs in each EA was also measured for all participants. EAs were classified as hotspots based on six criteria: 1) being in the top quartile of HRP2 prevalence, or having a qPCR prevalence above 10%, or an incidence above 50 cases/1000 persons years; 2) being in the top quartile for any of the three metrics mentioned previously; 3) using a hierarchical clustering method to classify the EAs based on their incidence and their prevalence by HRP2 and qPCR tests; 4) being in the top quartile of the incidence; 5) being in the top quartile of the HRP2 prevalence; and 6) being in the top quartile of the qPCR prevalence (Figure 1).

For the hierarchical clustering analysis, the best distance (euclidean, manhattan, canberra, binary, and minkowski) and the best agglomerative (ward.D, ward.D2, single, complete, average, and mcquitty) methods were selected based on the maximization of the agglomerative coefficient. The optimum number of clusters was evaluated from k = 2 to 15, and the best value of k was selected based on the minimization of the SD index (sum of the scattering within clusters and distance between clusters) proposed by Halkidi et al. 2000. Results were shown using a clustered heatmap, and the EAs belonging to the clusters with the highest incidence and prevalence that comprise the 75th quartile of the total EAs were defined as hotspots.

At the household level, the number of screened individuals and infected individuals per house was counted by each test (HRP2, qPCR, RDTs and uRDTs), and hotspots households were defined based on three criteria: 1) the number of individuals detected infected by HRP2 (greater than 2 infected individuals in the household) or by qPCR (greater than 1 infected individuals in the household) tests; 2) the number of individuals detected infected by HRP2 (greater than 2 infected individuals in the household) test; and 3) the number of individuals detected infected by qPCR (greater than 1 infected individuals in the household) test (Figure 1).

Performance of RDTs and uRDTs as predictors for hotspots was assessed by an empirical receiver operating characteristic (ROC) curve analysis implemented in the R package pROC. Two-sided 95% confidence intervals for the area under the curve (AUC) were measured base on DeLong method and the selection of the best threshold for predicted variables (prevalence by RDTs and uRDTs) was defined by the maximization of Youden index and its two-sided 95% confidence intervals were determined using an stratified bootstrap with 10,000 samples. Sensitivity, Positive and Negative predicted values, and accuracy were also measured for a fixed specificity at 85%, and their two-sided 95% confidence intervals were estimated using the Wilson score method implemented in the Hmisc R package. Statistical differences in the areas under the curves between the different tests (RDTs vs uRDTs) were assessed by a DeLong test and their corresponding statistical power was calculated.


```{r include = T, echo=FALSE, warning=FALSE,message=FALSE}
source("Required_packages.R")
source("fx_pROC_analysis.R")
source("fx_LOD.R")
source("fx_prop.hist.plot.R")
source("fx_performance.R")

# Upload iid data with read.dta13----
Namibia_iid_df<-read.dta13("Data/uRDT_analysis_BW_4146.dta", nonint.factors= T) # import uRDT data base, nonint.factors = T allows to import variable labels (some variables were stored as floats in stata)

#Namibia_eaid_df<-read.dta13("Data/EA_level_dataset_56.dta") # import ea data base

# tibble data.frame by iid and eaid---- 

# iid_df: ----
# long format tibble data.frame for iid`s`, just some variables will be used in order to facilitate its processing
iid_wdf <- Namibia_iid_df[c("iid", "hhid", "eaid",
                           "age", "gender",
                           "body_temp", "fever48",
                           "hrp2_posneg", "hrp2_pg_ml",
                           "pan_ldh_posneg", "ldh_pan_pg_ml",
                           "pv_ldh_posneg", "ldh_pv_pg_ml",
                           "qPCRposneg", "pden_mean",
                           "pf_result", "pm_result",
                           "po_result", "pv_result",
                           "cox3_result",
                           "rdtresult", "rdtresult_posneg",
                           "hsrdtresult"
                           )]

# Rename variables
names(iid_wdf) <- c(names(iid_wdf[1:7]),"HRP2", "hrp2_pg_ml",
                           "pan_LDH", "ldh_pan_pg_ml",
                           "pv_LDH", "ldh_pv_pg_ml",
                           "qPCR", "pden_mean",
                           "pf_result", "pm_result",
                           "po_result", "pv_result",
                           "cox3_result",
                           "RDT_cat", "RDT",
                           "uRDT") # rename tests


iid_wdf <- as_tibble(iid_wdf) # convert to tibble

iid_wdf[iid_wdf[["hhid"]] == "XSHH0855" & iid_wdf[["eaid"]] == "10699004",][["hhid"]]<-"XSHH0856" # Change the name of a repeated hhid code

# removing NA's
for (i in c("pf_result", "pm_result", "po_result", "pv_result")){
  iid_wdf[[i]] <- as.character(iid_wdf[[i]])
  iid_wdf[is.na(iid_wdf[[i]]),][[i]] <- "No tested"
  iid_wdf[[i]] <- as.factor(iid_wdf[[i]])
}

iid_wdf[is.na(iid_wdf$hrp2_pg_ml),][["hrp2_pg_ml"]]<-0
iid_wdf[is.na(iid_wdf$pden_mean),][["pden_mean"]]<-0
iid_wdf[is.na(iid_wdf$ldh_pan_pg_ml),][["ldh_pan_pg_ml"]]<-0
iid_wdf[is.na(iid_wdf$ldh_pv_pg_ml),][["ldh_pv_pg_ml"]]<-0


#Venn diagram to collapse the qualitative PCR results
qual_results <- list(Pf = iid_wdf[iid_wdf[["pf_result"]] == "Positive",][["iid"]],
                     Pm = iid_wdf[iid_wdf[["pm_result"]] == "Positive",][["iid"]],
                     Po = iid_wdf[iid_wdf[["po_result"]] == "Positive",][["iid"]],
                     Pv = iid_wdf[iid_wdf[["pv_result"]] == "Positive",][["iid"]])

qual_VennD <- ggVennDiagram(qual_results, label = "count")

iid_wdf %<>% mutate(qual_diag = case_when(
  pf_result == "Positive" & pm_result == "Negative" ~ "P. falciparum",
  pf_result == "Positive" & pm_result == "Positive" ~ "Pf Mixed infection",
  pf_result == "Negative" & pm_result == "Positive" ~ "P. malariae",
  pf_result == "Negative" & pm_result == "Negative" ~ "Negative",
  pf_result == "No tested" & pm_result == "Negative" ~ "Negative",
  pf_result == "No tested" & pm_result == "No tested" ~ "No tested"
))


# convert to long format

test<-c("HRP2", "qPCR", "RDT", "uRDT",
        "pan_LDH", "pv_LDH", "qual_diag")


iid_ldf<- iid_wdf %>% pivot_longer(all_of(test),# define the variables that will be converted to long format
                         names_to = "test",# assign a new variable named "test" where the categorical information is going to be stored
                         values_to = "result")# assign a new variables named "result" where the result of each test is going to be stored

# Population pyramid----
poppyramid<-as.data.frame(table(as.factor(iid_wdf$gender),as.numeric(iid_wdf$age)))# Counts the number of indv per age per gender

names(poppyramid)<-c("Gender", "Age", "Population")

pyr_plot <- ggplot(data = poppyramid, 
             mapping = aes(x = Age, y = ifelse(test = Gender == "Male", yes = -Population, no = Population), # variables that are going to be used to construct the plot
                           fill = Gender)) +
  geom_col() +
  theme_bw()+
  coord_flip() +# Change the orientation of the bars
  scale_y_continuous(labels = abs, limits = max(poppyramid$Population) * c(-1,1)) + 
  scale_x_discrete(breaks = seq(0,104,4))+
  scale_fill_manual(values = c("dodgerblue3", "firebrick3"))+
  labs(y = "Population")# change lables names

gender_prop <- iid_wdf %>%
  group_by(gender) %>%
  summarise(freq = n(), n = nrow(iid_wdf)) %>%
  group_by(gender) %>%
  mutate(prop = round(binconf(freq,
                        n,
                        alpha = 0.05,
                        method = "wilson")[1]*100,2),
         lower = round(binconf(freq,
                         n,
                         alpha = 0.05,
                         method = "wilson")[2]*100,2),
         upper = round(binconf(freq,
                         n,
                         alpha = 0.05,
                         method = "wilson")[3]*100,2))%>%ungroup()

                                                                                  
# descriptive information----

descriptives <- list(
  # Number of eaids
  neaids = nlevels(as.factor(iid_wdf$eaid)),
  # Number of iids                  
  niids = nlevels(as.factor(iid_wdf$iid)),
  # Number of hhids                   
  nhhids = nlevels(as.factor(iid_wdf$hhid)),
  # Number of performed tests                  
  ntests = nlevels(as.factor(iid_ldf$test)),
  # List of al performed tests                   
  tests_list = paste0(paste(levels(as.factor(iid_ldf$test))[-length(levels(as.factor(iid_ldf$test)))], collapse= ", "), sep = ", and ", levels(as.factor(iid_ldf$test))[length(levels(as.factor(iid_ldf$test)))]),
  # Number of positive samples by any test
  npos_any4 = iid_wdf %>% filter(HRP2 == "Positive"|
                               qPCR == "Positive"|
                               RDT == "Positive"|
                               uRDT == "Positive") %>% nrow(),
  # Number of all positive samples detected by HRP2                   
  npos_HRP2 = iid_ldf %>% filter(test == "HRP2", result == "Positive")%>%nrow(),
  # descriptive stats hrp2_pg_ml
  median_HRP2 = tibble(median = iid_wdf %>%
                   filter(HRP2=="Positive")%>%
                   select(hrp2_pg_ml)%>%
                   unlist()%>%
                   median(),
                 q25 = iid_wdf %>%
                   filter(HRP2=="Positive")%>%
                   select(hrp2_pg_ml)%>%
                   unlist()%>%
                   quantile(probs = .25),
                 q75 = iid_wdf %>%
                   filter(HRP2=="Positive")%>%
                   select(hrp2_pg_ml)%>%
                   unlist()%>%
                   quantile(probs = .75)),
  # Number of all positive samples detected by qPCR
  npos_qPCR = iid_ldf %>% filter(test == "qPCR", result == "Positive")%>%nrow(),
  # descriptive stats pden_mean
  median_qPCR = tibble(median = iid_wdf %>%
                   filter(qPCR=="Positive")%>%
                   select(pden_mean)%>%
                   unlist()%>%
                   median(),
                 q25 = iid_wdf %>%
                   filter(qPCR=="Positive")%>%
                   select(pden_mean)%>%
                   unlist()%>%
                   quantile(probs = .25),
                 q75 = iid_wdf %>%
                   filter(qPCR=="Positive")%>%
                   select(pden_mean)%>%
                   unlist()%>%
                   quantile(probs = .75)),
  # Number of all positive samples detected by RDTs
  npos_RDT = iid_ldf %>% filter(test == "RDT", result == "Positive")%>%nrow(),
  # descriptive stats hrp2_pg_ml in RDT postive samples
  median_HRP2_RDT = tibble(median = iid_wdf %>%
                   filter(HRP2=="Positive",RDT == "Positive")%>%
                   select(hrp2_pg_ml)%>%
                   unlist()%>%
                   median(),
                 q25 = iid_wdf %>%
                   filter(HRP2=="Positive", RDT == "Positive")%>%
                   select(hrp2_pg_ml)%>%
                   unlist()%>%
                   quantile(probs = .25),
                 q75 = iid_wdf %>%
                   filter(HRP2=="Positive", RDT == "Positive")%>%
                   select(hrp2_pg_ml)%>%
                   unlist()%>%
                   quantile(probs = .75)),
  # descriptive stats pden_mean in RDT positive samples
  median_qPCR_RDT = tibble(median = iid_wdf %>%
                   filter(qPCR=="Positive", RDT=="Positive")%>%
                   select(pden_mean)%>%
                   unlist()%>%
                   median(),
                 q25 = iid_wdf %>%
                   filter(qPCR=="Positive", RDT == "Positive")%>%
                   select(pden_mean)%>%
                   unlist()%>%
                   quantile(probs = .25),
                 q75 = iid_wdf %>%
                   filter(qPCR=="Positive", RDT == "Positive")%>%
                   select(pden_mean)%>%
                   unlist()%>%
                   quantile(probs = .75)),
  # Number of all positive samples detected by uRDTs
  npos_uRDT = iid_ldf %>% filter(test == "uRDT", result == "Positive")%>%nrow(),
    # descriptive stats hrp2_pg_ml in RDT postive samples
  median_HRP2_uRDT = tibble(median = iid_wdf %>%
                   filter(HRP2=="Positive",uRDT == "Positive")%>%
                   select(hrp2_pg_ml)%>%
                   unlist()%>%
                   median(),
                 q25 = iid_wdf %>%
                   filter(HRP2=="Positive", uRDT == "Positive")%>%
                   select(hrp2_pg_ml)%>%
                   unlist()%>%
                   quantile(probs = .25),
                 q75 = iid_wdf %>%
                   filter(HRP2=="Positive", uRDT == "Positive")%>%
                   select(hrp2_pg_ml)%>%
                   unlist()%>%
                   quantile(probs = .75)),
  # descriptive stats pden_mean in uRDT positive samples
  median_qPCR_uRDT = tibble(median = iid_wdf %>%
                   filter(qPCR=="Positive", uRDT=="Positive")%>%
                   select(pden_mean)%>%
                   unlist()%>%
                   median(),
                 q25 = iid_wdf %>%
                   filter(qPCR=="Positive", uRDT == "Positive")%>%
                   select(pden_mean)%>%
                   unlist()%>%
                   quantile(probs = .25),
                 q75 = iid_wdf %>%
                   filter(qPCR=="Positive", uRDT == "Positive")%>%
                   select(pden_mean)%>%
                   unlist()%>%
                   quantile(probs = .75)),
  # Number of all positive samples detected by pan_LDH
  npos_pan_LDH = iid_ldf %>% filter(test == "pan_LDH", result == "Positive")%>%nrow(),
  # Number of all positive samples detected by pv_LDH
  npos_pv_LDH = iid_ldf %>% filter(test == "pv_LDH", result == "Positive")%>%nrow(),
  # Number of only HRP2 positive samples
  only_HRP2 = iid_wdf %>% filter(HRP2 =="Positive",
                               qPCR !="Positive",
                               RDT !="Positive",
                               uRDT !="Positive")%>%nrow(),
  # Number of only qPCR positive samples
  only_qPCR = iid_wdf %>% filter(HRP2 !="Positive",
                               qPCR =="Positive",
                               RDT !="Positive",
                               uRDT !="Positive")%>%nrow(),
  # Number of only RDT positive samples
  only_RDT = iid_wdf %>% filter(HRP2 !="Positive",
                               qPCR !="Positive",
                               RDT =="Positive",
                               uRDT !="Positive")%>%nrow(),
  # Number of only uRDTs positive samples
  only_uRDT = iid_wdf %>% filter(HRP2 !="Positive",
                               qPCR !="Positive",
                               RDT !="Positive",
                               uRDT =="Positive")%>%nrow(),
  # Number of only qPCR and pan_LDH positive samples
  pos_qPCR_panLDH = iid_wdf %>% filter(HRP2 !="Positive",
                               qPCR =="Positive",
                               RDT !="Positive",
                               uRDT !="Positive",
                               pan_LDH == "Positive")%>%nrow(),
  # Number of only qPCR and pv_LDH positive samples
  pos_qPCR_pvLDH = iid_wdf %>% filter(HRP2 !="Positive",
                               qPCR =="Positive",
                               RDT !="Positive",
                               uRDT !="Positive",
                               pv_LDH == "Positive")%>%nrow(),
  # Qualitative qPCR of only qPCR and positive samples
  pos_qPCR_qualdiag = iid_wdf %>% filter(HRP2 !="Positive",
                               qPCR =="Positive",
                               RDT !="Positive",
                               uRDT !="Positive") %>%
    group_by(qual_diag) %>% summarise(nSamples= n())
                     )

performance_HRP2_all <- fx_performance(iid_wdf,
             reference = "HRP2",
             test = c("RDT", "uRDT"),
             pos = "Positive",
             neg = "Negative")

performance_HRP2.800less <- iid_wdf %>% filter(!(HRP2 == "Positive" & hrp2_pg_ml >= 800)) %>%
  fx_performance(reference = "HRP2",
             test = c("RDT", "uRDT"),
             pos = "Positive",
             neg = "Negative")

performance_HRP2.800high <- iid_wdf %>% filter(!(HRP2 == "Positive" & hrp2_pg_ml < 800))%>%
  fx_performance(reference = "HRP2",
             test = c("RDT", "uRDT"),
             pos = "Positive",
             neg = "Negative")

performance_qPCR_all <- fx_performance(iid_wdf,
             reference = "qPCR",
             test = c("RDT", "uRDT"),
             pos = "Positive",
             neg = "Negative")

performance_qPCR.100less <- iid_wdf %>% filter(!(qPCR == "Positive" & pden_mean >= 100)) %>%
  fx_performance(reference = "qPCR",
             test = c("RDT", "uRDT"),
             pos = "Positive",
             neg = "Negative")

performance_qPCR.100high <- iid_wdf %>% filter(!(qPCR == "Positive" & pden_mean < 100))%>%
  fx_performance(reference = "qPCR",
             test = c("RDT", "uRDT"),
             pos = "Positive",
             neg = "Negative")

performance_qPCR.2 <- iid_wdf %>%
  filter(!(qPCR == "Positive"&
             HRP2 !="Positive") & pden_mean <= 1000)%>%
  fx_performance(reference = "qPCR",
             test = c("RDT", "uRDT"),
             pos = "Positive",
             neg = "Negative")

performance_qPCR.2 <- iid_wdf %>%
  filter(!(qPCR == "Positive"&
             HRP2 !="Positive"))%>%
  fx_performance(reference = "qPCR",
             test = c("RDT", "uRDT"),
             pos = "Positive",
             neg = "Negative")

positive_iids <- list(HRP2 = iid_ldf[iid_ldf[["test"]] == "HRP2" & iid_ldf[["result"]] == "Positive",][["iid"]],
                      qPCR = iid_ldf[iid_ldf[["test"]] == "qPCR" & iid_ldf[["result"]] == "Positive",][["iid"]],
                      RDT = iid_ldf[iid_ldf[["test"]] == "RDT" & iid_ldf[["result"]] == "Positive",][["iid"]],
                      uRDT = iid_ldf[iid_ldf[["test"]] == "uRDT" & iid_ldf[["result"]] == "Positive",][["iid"]],
                      pan_LDH = iid_ldf[iid_ldf[["test"]] == "pan_LDH" & iid_ldf[["result"]] == "Positive",][["iid"]],
                      pv_LDH = iid_ldf[iid_ldf[["test"]] == "pv_LDH" & iid_ldf[["result"]] == "Positive",][["iid"]])

iid_VennD_4tests <- ggVennDiagram(positive_iids[c("HRP2", "qPCR", "RDT", "uRDT")], label = "count")



qPCR_vennD<- ggVennDiagram(list(qPCR = iid_ldf[iid_ldf[["test"]] == "qPCR" & iid_ldf[["result"]] == "Positive",][["iid"]],
                                only_qPCR = iid_wdf %>% filter(HRP2 !="Positive",
                               qPCR =="Positive",
                               RDT !="Positive",
                               uRDT !="Positive")%>%select(iid)%>%unlist,
     # pan_LDH = iid_ldf[iid_ldf[["test"]] == "pan_LDH" & iid_ldf[["result"]] == "Positive",][["iid"]],
     # pv_LDH = iid_ldf[iid_ldf[["test"]] == "pv_LDH" & iid_ldf[["result"]] == "Positive",][["iid"]],
     Pf = qual_results$Pf,
     Pm = qual_results$Pm), label = "count")




lod.RDT.hrp2 <- iid_ldf %>% filter(test == "RDT") %>% select (hrp2_pg_ml, result)%>%
  fx_lod(concentration = "hrp2_pg_ml",
       result = "result",
       precision = 0.1,
       from = 0,
       to = 20000,
       by = 100,
       xlab = "HRP2 pg/mL",
       ylab = "Proportion of RDT positive results")


lod.uRDT.hrp2 <- iid_ldf %>% filter(test == "uRDT") %>% select (hrp2_pg_ml, result)%>%
  fx_lod(concentration = "hrp2_pg_ml",
       result = "result",
       precision = 0.1,
       from = 0,
       to = 20000,
       by = 100,
       xlab = "HRP2 pg/mL",
       ylab = "Proportion of uRDT positive results")


lod.RDT.hrp2$glm.lod$test <- "RDT"
lod.uRDT.hrp2$glm.lod$test <- "uRDT"

lod.hrp2 <- rbind(lod.RDT.hrp2$glm.lod,lod.uRDT.hrp2$glm.lod)


lod.RDT.qpcr <- iid_ldf %>% filter(test == "RDT") %>% select (pden_mean, result)%>%
  fx_lod(concentration = "pden_mean",
       result = "result",
       upper = FALSE,
       precision = 10,
       from = 0,
       to = 20000,
       by = 100,
       xlab = "Parasites/mL",
       ylab = "Proportion of RDT positive results")


lod.uRDT.qpcr <- iid_ldf %>% filter(test == "uRDT") %>% select (pden_mean, result)%>%
  fx_lod(concentration = "pden_mean",
       result = "result",
       upper = FALSE,
       precision = 10,
       from = 0,
       to = 20000,
       by = 100,
       xlab = "Parasites/mL",
       ylab = "Proportion of uRDT positive results")


lod.RDT.qpcr$glm.lod$test <- "RDT"
lod.uRDT.qpcr$glm.lod$test <- "uRDT"

lod.qpcr <- rbind(lod.RDT.qpcr$glm.lod,lod.uRDT.qpcr$glm.lod)

lod.RDT.qpcr2 <- iid_wdf %>%
  filter(!(qPCR == "Positive"&
             HRP2 !="Positive") & pden_mean <= 1000)%>%
  pivot_longer(all_of(test),
               names_to = "test",
               values_to = "result") %>%
  filter(test == "RDT") %>% select (pden_mean, result)%>%
  fx_lod(concentration = "pden_mean",
         result = "result",
         upper = FALSE,
         precision = 10,
         from = 0,
         to = 500,
         by = .1,
         xlab = "Parasites/mL",
         ylab = "Proportion of RDT positive results")


lod.uRDT.qpcr2 <- iid_wdf %>%
  filter(!(qPCR == "Positive"&
             HRP2 !="Positive") & pden_mean <= 1000)%>%
  pivot_longer(all_of(test),
               names_to = "test",
               values_to = "result") %>%
  filter(test == "uRDT") %>% select (pden_mean, result)%>%
  fx_lod(concentration = "pden_mean",
         result = "result",
         upper = FALSE,
         precision = 10,
         from = 0,
         to = 500,
         by = .1,
         xlab = "Parasites/mL",
         ylab = "Proportion of uRDT positive results")


lod.RDT.qpcr2$glm.lod$test <- "RDT"
lod.uRDT.qpcr2$glm.lod$test <- "uRDT"

lod.qpcr2 <- rbind(lod.RDT.qpcr2$glm.lod,lod.uRDT.qpcr2$glm.lod)

```

## Results

### Consistncy among tests

Across 56 EAs surveyed, 4146 individuals from 1138 randomly selected households were tested for malaria using 4 different diagnostic test (HRP2, qPCR, RDT, and uRDT). The median age of participants was 17 years (IQR: 8 - 37) and the proportion of female and males were 55.57 (95% CI: 54.05 - 57.08) and 44.43 (95% CI: 42.92 - 45.95), respectively.

419 samples were positive by any of the tests. 317 samples were positive by HRP2 (183 samples were detected positive only by HRP2 and not by the other tests, Table 1 and Figure 2A), and the median concentration of HRP2 protein was 545.57 pg/mL (95% CI: 21 - 7019.52) (Table 1). For qPCR, 147 samples were positives (92 only by qPCR) and the median parasite density was 1.84 parasites/uL (95% CI: 0.51 - 13.24). For RDTs, 101 samples were positives (2 only by RDT), and the median of HRP2 concentration and parasite density along RDT positive samples were 11142.29 pg/mL (95% CI: 5756.645 – 16501.10) and 2.085 parasites/uL (95% CI: 0.56 - 13.39), respectively. Regarding uRDTs, 125 were positives (3 only by uRDTs), and the median of HRP2 concentration and parasite density along uRDT positive samples were 8861.14 pg/mL (95% CI: 5211.31 – 16501.10) and 2.86 parasites/uL (95% CI: 0.69 - 24.125), respectively (Figures 3A and 3D show the distribution of positive samples by HRP2 concentration and parasite density, respectively). Regarding the 92 that were detected only by qPCR, 29 were P. falciparum positive by the qPCR qualitative test (one of them was a mixed infection with P. malariae), and one sample was P. malariae (Figure 2B).

```{r include = T, echo=FALSE, warning=FALSE,message=FALSE, fig.width= 10, fig.height=5, fig.align = "center"}

plot_grid(iid_VennD_4tests, qPCR_vennD, ncol = 2, labels = c("A", "B"), label_size = 11, label_fontface = "plain")

```
<p style="font-size:8pt; font-style:italic">**Figure 2:** **A)** Consistency among HRP2, qPCR, RDT, and uRDT positive results; **B)** Consistency among samples only positive by qPCR but not by HRP2, RDT and uRDT (qPCR_only), with qualitative qPCR results (Pf and Pm, P. falciparum and P. malariae respectively).</p>

### Performance of RDTs and uRDTs in detecting infected or recently exposed individuals

Using HRP2 as standard method, RDTs detected 94 out of the 317 positive samples detected by HRP2 test, while uRDTs detected 117. In both cases, the proportion of positive detected samples increased as a function of the concentration of the HRP2 protein present in the sample (Figure 3B). The limit of detection, defined as the minimum concentration at which test detect more than 95% of the positive samples, of RDTs and uRDTs were 14215.13 and 10889.31, respectively (Figure 3C). In this way, the overall sensitivity and specificity for RDTs were 29.65 (95% CI: 24.89 - 34.9) and 99.82 (95% CI: 99.62 - 99.91), and for uRDT they were 36.91 (95% CI: 31.78 - 42.35) and 99.79 (95% CI: 99.59 - 99.89), respectively (Table 2). Constraining the analysis to samples with HRP2 concentration greater than 800pg/mL, the sensitivity and specificity for RDTs were 59.46 (95% CI: 51.41 - 67.03) and 99.82 (95% CI: 99.62 - 99.91); and for uRDT, were 71.62 (95% CI: 63.88 - 78.27) and 99.79 (95% CI: 99.59 - 99.89), respectively.

Performance of RDTs and uRDTs were worse when using qPCR as standard method, RDTs and uRDTs detected 38 and 39 out of the 147 positive samples detected by qPCR test, respectively. Moreover, the proportion of positive detected samples did not increase as a function of the parasite density of the sample (Figure 3E), and the limit of detection of RDTs and uRDTs were 15106.18 and 14148.69 respectively (Figure 3F). Thus, the overall sensitivity and specificity for RDTs were 25.85 (95% CI: 19.45 - 33.48) and 98.42 (95% CI: 97.99 - 98.77), and for uRDT they were 26.53 (95% CI: 20.06 - 34.2) and 97.85 (95% CI: 97.35 - 98.26), respectively. Restricting the analysis to samples with a parasitemia greater than 100 parasites/uL, the sensitivity and specificity for RDTs were 23.53 (95% CI: 9.56 - 47.26) and 98.42 (95% CI: 97.99 - 98.77); and for uRDT, were 35.29 (95% CI: 17.31 - 58.7) and 97.85 (95% CI: 97.35 - 98.26), respectively. However, when from the set of all qPCR positive samples, the HRP2 negative samples (assuming HRP2 gene deletion in these samples) and samples with more than 1000 parasites/uL (low number of samples) were excluded, LOD for RDTs and uRDTs were 398.04 and 219.91 parasites/uL, respectively (Figure 3H). Furthermore, the sensitivity for both tests also increased. Sensitivity for RDTs was 68.52 (95% CI: 55.26 - 79.32) and for uRDT it was 70.37 (95% CI: 57.17 - 80.86).

```{r include = T, echo=FALSE, warning=FALSE,message=FALSE, fig.width= 10, fig.height=10, fig.align = "center"}

plot.HRP2_hist<-iid_ldf %>% filter(test == "RDT" | test == "uRDT") %>%
  mutate(result2 = case_when(result=="Negative"~"g1",
                             test == "RDT"&result=="Positive"~"g2",
                             test == "uRDT"&result=="Positive"~"g3"))%>%
  ggplot(aes(x = log10(hrp2_pg_ml), color = result2, fill = result2)) +
  geom_histogram(position = "stack", bins = 60) +
  labs(y = "# of samples or iids",
       x = "HRP2 pg/mL in log10 scale") +
  facet_wrap(.~test, nrow = 2)+
  scale_color_manual(values = c("dodgerblue4", "coral", "firebrick3"))+
  scale_fill_manual(values = c("dodgerblue4", "coral", "firebrick3"))+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0, size = 11)) +
  theme(axis.title.x = element_text(size = 10)) +
  theme(axis.title.y = element_text(size = 10)) +
  theme(axis.text = element_text(size = 10), legend.position = "none")+
  scale_x_continuous(breaks = 0:4, labels = c(1, 10, 100, 1000, 10000))


plot.HRP2_prop<-iid_ldf %>% filter(test == "RDT" | test == "uRDT") %>%
  mutate(result2 = case_when(result=="Negative"~"g1",
                             test == "RDT"&result=="Positive"~"g2",
                             test == "uRDT"&result=="Positive"~"g3"))%>%
  fx_prop.hist.plot(bins = 60,
                  quant.var = "hrp2_pg_ml",
                  qual.var = "result2",
                  group.var = "test",
                  log.scale = TRUE,
                  colors = c("dodgerblue4","coral", "firebrick3"),
                  y.title = "Proportion of samples or iids",
                  x.title = "HRP2 pg/mL in log10 scale",
                  legend.title = "Result",
                  legend.position = "none")

lod.hrp2.plot <- lod.hrp2 %>% ggplot(aes(x = concentration, y = prob, color = test)) +
    geom_line()+
    geom_ribbon(aes(ymin = lower, ymax = upper, fill = test), alpha = 0.2, linetype = 3) +
    geom_vline(xintercept = c(lod.RDT.hrp2$lod$lod, lod.RDT.hrp2$lod$lower, lod.RDT.hrp2$lod$upper), color = c("coral", "coral", "coral"), size = 1, linetype = c(1,3,3)) +
    geom_vline(xintercept = c(lod.uRDT.hrp2$lod$lod, lod.uRDT.hrp2$lod$lower, lod.uRDT.hrp2$lod$upper), color = c("firebrick3", "firebrick3", "firebrick3"), size = 1, linetype = c(1,3,3)) +
  geom_point(x = lod.RDT.hrp2$lod$lod, y = 0.95, color = "black") +
  geom_point(x = lod.uRDT.hrp2$lod$lod, y = 0.95, color = "black") +
  geom_text(aes(x = lod.RDT.hrp2$lod$lod*1.1, y = 0.9), label = round(lod.RDT.hrp2$lod$lod, 2), color = "black", size = 3.2 )+
  geom_text(aes(x = lod.uRDT.hrp2$lod$lod*0.8, y = 0.95), label = round(lod.uRDT.hrp2$lod$lod, 2), color = "black", size = 3.2 )+
    theme_bw() +
  scale_color_manual(values = c("coral", "firebrick4"))+
  scale_fill_manual(values = c("coral", "firebrick4"))+
    labs(y = "Proportion of positive results",
         x = "HRP2 pg/mL",
         color = "Test",
         fill = "Test") +
    theme(plot.title = element_text(hjust = 0, size = 11),
          axis.title = element_text(size = 10),
          axis.text = element_text(size = 10),
          legend.position = "none") +
    scale_x_continuous(expand = c(0, 0.02*max(lod.hrp2$concentration)), breaks = seq(0, 20000, 2000)) +
    scale_y_continuous(expand = c(0, 0.02*max(lod.hrp2$upper)), breaks = seq(0, 1, 0.1))+
  theme(axis.text.x = element_text(angle = 45,vjust = 0.5))


plot.qPCR_hist<-iid_ldf %>% filter(test == "RDT" | test == "uRDT") %>%
  mutate(result2 = case_when(result=="Negative"~"g1",
                             test == "RDT"&result=="Positive"~"g2",
                             test == "uRDT"&result=="Positive"~"g3"))%>%
  ggplot(aes(x = log10(pden_mean), color = result2, fill = result2)) +
  geom_histogram(position = "stack", bins = 60) +
  labs(y = "# of samples or iids",
       x = "Parasites/uL in log10 scale") +
  facet_wrap(.~test, nrow = 2)+
  scale_color_manual(values = c("dodgerblue4", "coral", "firebrick3"))+
  scale_fill_manual(values = c("dodgerblue4", "coral", "firebrick3"))+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0, size = 11)) +
  theme(axis.title.x = element_text(size = 10)) +
  theme(axis.title.y = element_text(size = 10)) +
  theme(axis.text = element_text(size = 10), legend.position = "none")+
  scale_x_continuous(breaks = 0:4, labels = c(1, 10, 100, 1000, 10000))


plot.qPCR_prop<-iid_ldf %>% filter(test == "RDT" | test == "uRDT") %>%
  mutate(result2 = case_when(result=="Negative"~"g1",
                             test == "RDT"&result=="Positive"~"g2",
                             test == "uRDT"&result=="Positive"~"g3"))%>%
  fx_prop.hist.plot(bins = 20,
                  quant.var = "pden_mean",
                  qual.var = "result2",
                  group.var = "test",
                  log.scale = TRUE,
                  colors = c("dodgerblue4", "coral", "firebrick3"),
                  y.title = "Proportion of samples or iids",
                  x.title = "Parasites/uL in log10 scale",
                  legend.title = "Result",
                  legend.position = "none")


lod.qPCR.plot <- lod.qpcr %>% ggplot(aes(x = concentration, y = prob, color = test)) +
    geom_line()+
    geom_ribbon(aes(ymin = lower, ymax = upper, fill = test), alpha = 0.2, linetype = 3) +
    geom_vline(xintercept = c(lod.RDT.qpcr$lod$lod, lod.RDT.qpcr$lod$lower), color = c("coral", "coral"), size = 1, linetype = c(1,3)) +
    geom_vline(xintercept = c(lod.uRDT.qpcr$lod$lod, lod.uRDT.qpcr$lod$lower), color = c("firebrick3", "firebrick3"), size = 1, linetype = c(1,3)) +
  geom_point(x = lod.RDT.qpcr$lod$lod, y = 0.95, color = "black") +
  geom_point(x = lod.uRDT.qpcr$lod$lod, y = 0.95, color = "black") +
  geom_text(aes(x = lod.RDT.qpcr$lod$lod*1.1, y = 0.9), label = round(lod.RDT.qpcr$lod$lod, 2), color = "black", size = 3.2 )+
  geom_text(aes(x = lod.uRDT.qpcr$lod$lod*0.8, y = 0.95), label = round(lod.uRDT.qpcr$lod$lod, 2), color = "black", size = 3.2 )+
    theme_bw() +
  scale_color_manual(values = c("coral", "firebrick4"))+
  scale_fill_manual(values = c("coral", "firebrick4"))+
    labs(y = "Proportion of positive results",
         x = "Parasites/uL",
         color = "Test",
         fill = "Test") +
    theme(plot.title = element_text(hjust = 0, size = 11),
          axis.title = element_text(size = 10),
          axis.text = element_text(size = 10),
          legend.position = "none") +
    scale_x_continuous(expand = c(0, 0.02*max(lod.qpcr$concentration)), breaks = seq(0, 20000, 2000)) +
    scale_y_continuous(expand = c(0, 0.02*max(lod.qpcr$upper)), breaks = seq(0, 1, 0.1))+
  theme(axis.text.x = element_text(angle = 45,vjust = 0.5))

plot.qPCR_hist2<- iid_wdf %>%
  filter(!(qPCR == "Positive"&
             HRP2 !="Positive"))%>%
  pivot_longer(all_of(test),
               names_to = "test",
               values_to = "result") %>%
  filter(test == "RDT" | test == "uRDT") %>%
  mutate(result2 = case_when(result=="Negative"~"g1",
                             test == "RDT"&result=="Positive"~"g2",
                             test == "uRDT"&result=="Positive"~"g3"))%>%
  ggplot(aes(x = log10(pden_mean), color = result2, fill = result2)) +
  geom_histogram(position = "stack", bins = 60) +
  labs(y = "# of samples or iids",
       x = "Parasites/uL in log10 scale") +
  facet_wrap(.~test, nrow = 2)+
  scale_color_manual(values = c("dodgerblue4", "coral", "firebrick3"))+
  scale_fill_manual(values = c("dodgerblue4", "coral", "firebrick3"))+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0, size = 11)) +
  theme(axis.title.x = element_text(size = 10)) +
  theme(axis.title.y = element_text(size = 10)) +
  theme(axis.text = element_text(size = 10), legend.position = "none")+
  scale_x_continuous(breaks = 0:4, labels = c(1, 10, 100, 1000, 10000))


plot.qPCR_prop2 <- iid_wdf %>%
  filter(!(qPCR == "Positive"&
             HRP2 !="Positive"))%>%
  pivot_longer(all_of(test),
               names_to = "test",
               values_to = "result") %>%
  filter(test == "RDT" | test == "uRDT") %>%
  mutate(result2 = case_when(result=="Negative"~"g1",
                             test == "RDT"&result=="Positive"~"g2",
                             test == "uRDT"&result=="Positive"~"g3"))%>%
  fx_prop.hist.plot(bins = 20,
                    quant.var = "pden_mean",
                    qual.var = "result2",
                    group.var = "test",
                    log.scale = TRUE,
                    colors = c("dodgerblue4", "coral", "firebrick3"),
                    y.title = "Proportion of samples or iids",
                    x.title = "Parasites/uL in log10 scale",
                    legend.title = "Result",
                    legend.position = "none")

lod.qPCR.plot2 <- lod.qpcr2 %>% ggplot(aes(x = concentration, y = prob, color = test)) +
  geom_line()+
  geom_ribbon(aes(ymin = lower, ymax = upper, fill = test), alpha = 0.2, linetype = 3) +
  geom_vline(xintercept = c(lod.RDT.qpcr2$lod$lod, lod.RDT.qpcr2$lod$lower), color = c("coral", "coral"), size = 1, linetype = c(1,3)) +
  geom_vline(xintercept = c(lod.uRDT.qpcr2$lod$lod, lod.uRDT.qpcr2$lod$lower), color = c("firebrick3", "firebrick3"), size = 1, linetype = c(1,3)) +
  geom_point(x = lod.RDT.qpcr2$lod$lod, y = 0.95, color = "black") +
  geom_point(x = lod.uRDT.qpcr2$lod$lod, y = 0.95, color = "black") +
  geom_text(aes(x = lod.RDT.qpcr2$lod$lod*1.1, y = 0.9), label = round(lod.RDT.qpcr2$lod$lod, 2), color = "black", size = 3.2 )+
  geom_text(aes(x = lod.uRDT.qpcr2$lod$lod*0.8, y = 0.95), label = round(lod.uRDT.qpcr2$lod$lod, 2), color = "black", size = 3.2 )+
  theme_bw() +
  scale_color_manual(values = c("coral", "firebrick4"))+
  scale_fill_manual(values = c("coral", "firebrick4"))+
  labs(y = "Proportion of positive results",
       x = "Parasites/uL",
       color = "Test",
       fill = "Test") +
  theme(plot.title = element_text(hjust = 0, size = 11),
        axis.title = element_text(size = 10),
        axis.text = element_text(size = 10),
        legend.position = "none") +
  scale_x_continuous(expand = c(0, 0.02*max(lod.qpcr2$concentration)), breaks = seq(0, 500, 50), limits = c(0,500)) +
  scale_y_continuous(expand = c(0, 0.02*max(lod.qpcr2$upper)), breaks = seq(0, 1, 0.1))+
  theme(axis.text.x = element_text(angle = 45,vjust = 0.5))

plot1 <- plot_grid(plot_grid(plot.HRP2_hist,
                        plot.HRP2_prop$prop.plot, lod.hrp2.plot,
                        ncol = 3, labels = c("A", "B", "C"), label_size = 11, label_fontface = "plain"),
                   plot_grid(plot.qPCR_hist,
                        plot.qPCR_prop$prop.plot, lod.qPCR.plot,
                        ncol = 3, labels = c("D", "E", "F"), label_size = 11, label_fontface = "plain"),
                   plot_grid(plot.qPCR_hist2,
          plot.qPCR_prop2$prop.plot, lod.qPCR.plot2,
          ncol = 3, labels = c("G", "H", "I"), label_size = 11, label_fontface = "plain"),
          nrow = 3)

plot1

```
<p style="font-size:8pt; font-style:italic">**Figure 3:** Performance of RDT and uRDT taking as reference HRP2 results (**A**, **B** and **C**), qPCR (**D**, **E** and **F**), and qPCR without HRP2 negative results and samples with parasite densities about 1000 parasites/uL (**G**, **H** and **I**). Figures **A**, **D** and **G** represents the  distribution of the number negative (dark blue) and positive samples by RDT (coral) and uRDT (dark red) per range of HRP2 concentration or parasite density. Figures **B**, **E** and **H** represents the  proportion of negative and positive samples per range of HRP2 concentration or parasite density. Finally, figures **C**, **F** and **I** show the binomial logistic regression model of the relation between proportion of positive results by RDT (coral) or by uRDT (dark red) and the concentration of the HRP2 protein or the parasite density. Solid lines represent the estimated limit of detection of each method, and dotted lines thier confidence intervals.</p>

### Performance of RDTs and uRDTs in detecting at EA hotspots

Fifty-two out of the 56 EAs met the inclusion criteria, and along these EAs 3699 individuals or individuals (in 1011 households or HHs) were screened by RDTs, uRDTs, qPCR, and HRP2 tests (Sup. Table 1). A median of 63.5 individuals (IQR = 39.2, range from 25 to 150) and 18 HHsHHs (IQR = 7.25, range from 7 to 36) were screened in the 52 EAs, and a median of 3 individuals (IQR = 3, range from 1 to 73) were screened per household (Figure 3 and ST2). 375 individuals were positive for any of the 4 tests performed (278 for HRP2, 134 for qPCR, 89 for RDTs and 111 for uRDTs) (ST3), and 246 households had positive individuals for any of these tests (204 by the HRP2, 87 by qPCR, 76 by RDTs, and 92 households by uRDTs) (ST3).

In the tests used as reference to define hotspots (HRP2 and qPCR), the median prevalence by HRP2 and qPCR were 6.35 (IQR = ± 6.09, range from 0.9 to 30.6) and 1.8 (IQR = ± 4.08, and range from 0 to 44.7), respectively (Figure 4 and ST4). Moreover, the median incidence in the EAs was 20.52 cases/1000 persons years (± 36.19 IQR, range from 0 to 199.95). Regarding RDTs and uRDTs, the median prevalence’s were 1.98 (± 3.18 IQR), and 2.35 (± 4.29 IQR), respectively (Figure 4, ST4).

Regardless of the criteria used to select hotspots, uRDTs had greater areas under the curve (AUCs) than RDTs at EA level. Using the first criterion (Incidence > 50 py, prevalence by HRP2 > 75% quartile, or prevalence by qPCR > 10%), 19 EAs were defined as hotspots. The AUC of the prevalence by uRDTs (AUC = 0.844, 95%CI 0.724 - 0.964) was statistically greater than its counterpart using RDTs (AUC = 0.758, 95%CI 0.612 - 0.903) (p-value < 0.05, Figure 5, ST5). Its sensitivity, accuracy, ppv, and npv at the fixed specificity of 85% were 68.4%, 78.9%, 72.4% and 82.4%, respectively (Figure 5). In the case of the prevalence by RDTs, the sensitivity, accuracy, ppv, and npv were 52.6%, 73.2%, 66.9% and 75.7%, respectively.

Similar results were observed when using the hierarchical clustering method to define hotspots. A dendrogram based on Manhattann distance and the agglomerative Ward.D method was built, and 6 clusters (SD index for K6 = 2.65) were found (Supplementary figure 1 and Supplementary figure 2). Clusters 1 - 4 comprised the 75th quartile of the total EAs, thus 15 EAs were defined as hotspots. The AUC for uRDTs was 0.86 (95%CI 0.75 - 0.97) and it was statistically greater than RDTs (0.74). For uRDTs, the sensitivity, accuracy, ppv, and npv were 73.3%, 81.6%, 66.5%, and 88.7%, respectively. Regarding RDTs, the sensitivity, accuracy, ppv, and npv were 53.3%, 75.9%, 59%, and 81.8%, respectively. Results for the other criteria are found in SF3 - SF4 and ST5 - ST6.

### Performance of RDTs and uRDTs at household level

Because of the presence of outliers in the number of individuals per HHs (more than 60 individuals per HHs) and the large number of households with just one individual screened, only households with 2 or more individuals and less than 20 individuals were included to analyze the performance of RDTs and uRDTs at household level. For all tests, a median of one infected individual per household was found, and a total of 227/815 households had at least one individual detected infected for any of the four tests (191 by HRP2, 81 by qPCR, 71 by RDTs, and 87 by uRDTs) (Figure 6).

One hundred twelve households were classified as hotspots and the AUC for uRDTs was 0.705, while the AUC for RDTs was 0.704 (p-value = 0.5, power = 0.07) (ST5). Additionally, none of the tests had a good performance in terms of sensitivity, 45.5% (CI95% 36.6 - 54.8) for uRDTs and 43.8% (CI95% 34.9 - 53) for RDTs (Figure 7, ST6). Performance using the other two criteria are shown in Supplementary figure 5.

## Discussion

Topic 1: Main findings (confirmation or refusal of the proposed hypothesis)
uRDTs have greater performance than RDTs in detecting EA hotspots but depends on the threshold used to define hotspots.
Topic 2: Secondary findings and comparisons with previous studies
No differences were found at household level. 
Large inconsistency between HRP2 based tests and qPCR. HRP2 positives and qPCR negatives: HRP2 antigen persist up to a month in blood. HRP2 negative qPCR positives: HRP2 gene is deleted or no active?
Topic 3: Limitations and scope of our findings
Topic 4: Summary, implications of our findings and conclusions

## Acknowledgements
We thank study participants, and support from field staff, Ministry of Health and Social Services, and others on the study team (Mi-suk Kang Dufour, Leah Schrubbe, Joy Yala, Sofonias Tessema).





